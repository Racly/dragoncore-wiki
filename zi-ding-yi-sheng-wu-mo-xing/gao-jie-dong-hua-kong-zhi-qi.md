# 高阶-动画控制器



{% hint style="info" %}
除非存在特殊需要，否则不需要填写该配置
{% endhint %}

{% hint style="info" %}
该功能用于需要多层次定义动画行为

或需要设定多个动画同时播放
{% endhint %}

### 配置文件EntityModel.yml

```
# 为配置增加选项,该文件也一样是放到和模型同一个目录下
controller: "控制器.yml"
```

### 控制器.yml

```
# =========================
# 默认情况下,所有未配置动画层的动画都会分配在base动画层下,且base是第一级动画层
# 每个动画的播放都会顶替掉同一个动画层的当前播放的动画
# =========================

# 动画层的意义是用于同时播放多个动画用的,比如 你可以在播放任何动画时,同时播放眨眼动画
# 每个动画层都可以播放一个动画,最终效果是按动画层内的blendType决定
Layer:
  # 默认动画层
  base:
    animations:
      - "walk"
      - "idle"
    # 动画播放完成后自动播放的下一个动画
    next: "idle"
  skill:
    # 混合模式,分为OVERRIDE(覆盖模式),ADDING(叠加模式),错误的模式将默认使用OVERRIDE
    # 覆盖模式: 假设base层的动画令【手臂】旋转了50°, action层的动画令【手臂】旋转了60°
    #          最终结果就是base层手臂的旋转无效了,最终结果是action层的60°
    #          但如果是base层的动画令【手臂】旋转了50°, action层的动画【没有去控制手臂】,而是令【头】旋转了60°
    #          则【手臂】的旋转依旧保留,【头】则以action层的为准
    #
    # 叠加模式: 还是上面那个假设,此时最终的结果是 50°+60°共旋转110°，后面的假设结果则最终效果相同
    # 
    # 有一点要注意: 假如你在bb里设置了某个动画为覆盖模式,也就是你导出后的文件
    #              里有override_previous_animation: true
    #              它会在应用动画效果到模型前 将前面所有动画层的效果全部清除
    #              只保留当前动画的效果,按照上述覆盖模式里的第二个假设来讲
    #              就是【手臂】的动画会被清除,仅保留【头】的旋转
    #
    blendType: OVERRIDE
    animations:
      - "attack-body"
      

# 非特殊情况下你只需要使用下面的配置即可,不要改动

# 关于 方法.动画是否播放中  是一种模糊判断,也就是当前播放的动作中【包含】这些字就返回true的结果
#      方法.是否有动画     也同理
#      方法.播放动画       会优先寻找是否完整匹配名称的动画进行播放,如果没有,就播放包含这些字的一个动画
Trigger:
  # 初始化执行
  init: |-
    界面变量.静止动画 = 'idle';
    界面变量.移动动画 = 'walk';
    界面变量.攻击动画 = 'attack';
    界面变量.死亡动画 = 'death';
    方法.播放动画(界面变量.静止动画,0);
    
  # 动画结束时执行
  animationEnd: |-
    (方法.包含(temp.args.0,'death') && !方法.包含(temp.args.0,'idle') && !方法.包含(temp.args.0,'walk'))?{
      方法.移除实体;
    }:0;
    
  # 实体站立时执行
  stand: |-
    (!方法.动画层是否播放中('base') || 方法.动画是否播放中('walk'))?{
      方法.播放动画(界面变量.静止动画);
    }:0;
  
  # 实体移动时执行
  walk: |-
    (!方法.动画层是否播放中('base') || 方法.动画是否播放中('idle'))?{
      方法.播放动画(界面变量.移动动画);
    }:0;
  
  # 实体攻击时执行
  attack: |-
    (!方法.动画层是否播放中('base') || 方法.动画是否播放中('idle') || 方法.动画是否播放中('walk'))?{
      方法.播放动画(界面变量.攻击动画);
    }:0;
    
  # 实体血量<=0时执行
  death: |-
    (方法.是否有动画(界面变量.死亡动画))?{
      方法.播放动画(界面变量.死亡动画);
      方法.移除死亡计数;
    }:0;
```

### &#x20;
